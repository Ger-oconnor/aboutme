<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!-- Ensures the page is responsive on mobile devices -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Rules</title>
  <!-- Include Chart.js, Moment.js and the Chart.js Moment adapter -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment"></script>
  <style>
    /* Reset and basic styling */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: sans-serif;
      color: #333;
      line-height: 1.5;
      padding: 1rem;
    }
    /* Headings */
    h1,
    h2 {
      margin-bottom: 0.5rem;
    }
    /* Container */
    .container {
      max-width: 800px;
      margin: 0 auto;
    }
    /* Section spacing */
    .section {
      margin-bottom: 1.5rem;
    }
    .section p {
      margin-top: 0.25rem;
    }
    /* Label List (top labels) */
    .label-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1rem;
      justify-content: center;
    }
    .label-item {
      padding: 0.5rem 1rem;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
      color: #333;
    }
    .label-item.active,
    .label-item:hover {
      opacity: 0.8;
    }
    .label-item.active {
      font-weight: bold;
    }
    /* Item List */
    .item-list {
      width: 100%;
    }
    .item {
      display: flex;
      flex-wrap: wrap; /* Allow wrapping if screen width is small */
      align-items: center;
      gap: 1rem;
      margin-bottom: 0.5rem;
      padding: 0.5rem;
      border-bottom: 1px solid #ccc;
    }
    .item-priority {
      color: #666;
      font-size: 0.9rem;
      font-weight: bold;
    }
    .item-title {
      flex: 1; /* expand to fill space if available */
      font-weight: normal;
    }
    /* Inline labels at the end of each rule */
    .item-labels {
      display: flex;
      flex-wrap: wrap;
      gap: 0.25rem;
    }
    .inline-label {
      border-radius: 5px;
      padding: 0.25rem 0.5rem;
      cursor: pointer;
      transition: background-color 0.3s;
      font-size: 0.8rem;
      color: #333;
    }
    .inline-label:hover {
      opacity: 0.8;
    }
    /* Tweet icon link */
    .tweet-icon-link {
      display: inline-flex;
      align-items: center;
      text-decoration: none;
      gap: 0.25rem; /* space between icon and count */
    }
    .tweet-icon {
      width: 16px;
      height: 16px;
      fill: #1da1f2;
      transition: fill 0.2s;
    }
    .tweet-icon-link:hover .tweet-icon {
      fill: #148cd2;
    }
    /* Responsive adjustments */
    @media (max-width: 600px) {
      .container {
        padding: 0 1rem;
      }
    }
    /* -------------------------------
       New Styles for OKRs, Metrics & Graphs
    ------------------------------- */
    .collapsible {
      background-color: #0073e6;
      color: #fff;
      cursor: pointer;
      padding: 10px 16px;
      width: 100%;
      border: none;
      text-align: left;
      outline: none;
      font-size: 1.5rem;
      border-radius: 4px;
      margin-bottom: 0.5rem;
    }
    .collapsible.active,
    .collapsible:hover {
      background-color: #005bb5;
    }
    .content {
      padding: 0 1rem;
      display: none;
      overflow: hidden;
      border-left: 2px solid #0073e6;
      margin-bottom: 2rem;
    }
    .okrs-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1.5rem;
      margin-top: 1rem;
    }
    .okr-card {
      background: #fff;
      border-radius: 8px;
      padding: 1.5rem;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s;
    }
    .okr-card:hover {
      transform: translateY(-4px);
    }
    .okr-objective {
      font-size: 1.25rem;
      margin-bottom: 0.3rem;
      color: #222;
    }
    .okr-status {
      font-size: 0.9rem;
      font-weight: bold;
      padding: 4px 8px;
      border-radius: 4px;
      display: inline-block;
      margin-bottom: 1rem;
    }
    /* Status classes */
    .achieved {
      background-color: #4caf50;
      color: #fff;
    }
    .not-achieved {
      background-color: #f44336;
      color: #fff;
    }
    .not-started {
      background-color: #9e9e9e;
      color: #fff;
    }
    .committed {
      background-color: #2196f3;
      color: #fff;
    }
    .abandoned {
      background-color: #795548;
      color: #fff;
    }
    .okr-krs {
      list-style: none;
      padding-left: 0;
    }
    .okr-krs li {
      background: #f1f1f1;
      margin-bottom: 0.75rem;
      padding: 0.75rem;
      border-radius: 4px;
      font-size: 0.95rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .kr-text {
      flex: 1;
      margin-right: 1rem;
    }
    .kr-meta {
      text-align: right;
    }
    .kr-date {
      display: block;
      font-size: 0.8rem;
      color: #555;
    }
    .kr-confidence {
      display: inline-block;
      padding: 2px 6px;
      font-size: 0.8rem;
      font-weight: bold;
      border-radius: 4px;
      color: #fff;
      margin-top: 0.2rem;
    }
    /* Confidence color classes */
    .confidence-red {
      background-color: #f44336;
    }
    .confidence-amber {
      background-color: #ff9800;
    }
    .confidence-green {
      background-color: #4caf50;
    }
    .metrics-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    .metrics-table th,
    .metrics-table td {
      border: 1px solid #ccc;
      padding: 8px 12px;
      text-align: center;
    }
    .metrics-table th {
      background-color: #0073e6;
      color: #fff;
    }
    .metrics-table caption {
      caption-side: top;
      text-align: left;
      font-size: 1.2rem;
      margin-bottom: 8px;
      font-weight: bold;
    }
  </style>
  <!-- Embedded JSON file for OKRs and Metrics -->
  <script type="application/json" id="okrsMetricsData">
{
  "okrs": {
    "parent": [
      {
        "objective": "Establish a Platform for Achieving Outcomes",
        "status": "Achieved",
        "krs": [
          {
            "text": "Set up the platform",
            "due": "Q1",
            "confidence": 0.60
          },
          {
            "text": "Create value through 12 podcasts, youtube, blogs",
            "due": "Q2",
            "confidence": 0.50
          },
          {
            "text": "Establish crediblity through podcasts & conferences",
            "due": "Q3",
            "confidence": 0.50
          }
        ]
      }
    ],
    "quarterly": [
      {
        "objective": "CSL is in well organised and ready for 2025",
        "status": "Committed",
        "krs": [
          {
            "text": "Create a meeting to Define our goals",
            "due": "2025-02-22",
            "confidence": 0.80
          },
          {
            "text": "Create and test a marketing funnel for CSL",
            "due": "2025-02-22",
            "confidence": 0.80
          },
          {
            "text": "Organise goals in this format",
            "due": "2025-09-23",
            "confidence": 0.80
          },
          {
            "text": "Add the goals and complete this one",
            "due": "2025-02-23",
            "confidence": 0.80
          }
        ]
      },
      {
        "objective": "Be in a state of Non-Omission",
        "status": "Committed",
        "krs": [
          {
            "text": "Record and track the following three things diligently every day.",
            "due": "2025-03-31",
            "confidence": 0.80
          },
          {
            "text": "Do all the excercises everyday.",
            "due": "2025-03-31",
            "confidence": 0.50
          },
          {
            "text": "Do 4 RT a day.",
            "due": "2025-03-31",
            "confidence": 0.50
          },
          {
            "text": "Read a lecture.",
            "due": "2025-03-31",
            "confidence": 0.50
          }
        ]
      },
      {
        "objective": "Complete captstone, and start DCEO",
        "status": "Committed",
        "krs": [
          {
            "text": "Deliver presentation for Capstone",
            "due": "2025-02-8",
            "confidence": 1
          },
          {
            "text": "Complete capstone module",
            "due": "2025-02-17",
            "confidence": 0.80
          },
          {
            "text": "Lunch with the new team to kick off DECO",
            "due": "2025-02-22",
            "confidence": 0.80
          }
        ]
      },
          {
        "objective": "Master the art of teaching from the back of the room, and deliver a successful workshop in HKU",
        "status": "Committed",
        "krs": [
          {
            "text": "Create a second brain for learning materials",
            "due": "2025-02-1",
            "confidence": 1
          },
          {
            "text": "Create an outline of the 3 hour workshop",
            "due": "2025-02-18",
            "confidence": 0.8
          },
          {
            "text": "Create the full deck",
            "due": "2025-02-21",
            "confidence": 0.50
          },
          {
            "text": "Deliver a trial run of the first hour of the workshop & Refine",
            "due": "2025-02-28",
            "confidence": 0.50
          },
          {
            "text": "Deliver a trial run of the second hour of the workshop & Refine",
            "due": "2025-03-07",
            "confidence": 0.50
          },
          {
            "text": "Deliver a trial run of the third hour of the workshop & Refine",
            "due": "2025-03-14",
            "confidence": 0.50
          },
          {
            "text": "Successfully deliver the session in HKU",
            "due": "2025-03-18",
            "confidence": 0.80
          }
        ]
      }
    ,
          {
        "objective": "Be in Control of my Finances",
        "status": "Committed",
        "krs": [
          {
            "text": "Create an initial draft plan with my financial advisor",
            "due": "2025-02-8",
            "confidence": 0.60
          },
          {
            "text": "Refine the plan into a good first working draft",
            "due": "2025-03-15",
            "confidence": 0.60
          },
          {
            "text": "Set a target on when I will be financially independent",
            "due": "2025-02-22",
            "confidence": 0.60
          }
        ]
      },
          {
        "objective": "Create a platform for sharing my knowledge and expertise (STRETCH)",
        "status": "Not Started",
        "krs": [
          {
            "text": "Document flow at enterprise Blue Print",
            "due": "2025-02-17",
            "confidence": 0.9
          },
          {
            "text": "Document draft of the AO Coaching Model",
            "due": "2025-02-17",
            "confidence": 0.9
          },
          {
            "text": "Create a draft of website structure",
            "due": "2025-02-23",
            "confidence": 0.00
          },
          {
            "text": "Platform is live",
            "due": "2025-03-31",
            "confidence": 0.00
          }
        ]
      },
          {
        "objective": "Get in Perfect shape",
        "status": "Committed",
        "krs": [
          {
            "text": "Eat No carbs or sugar and keep calorie intake below 1500 (measure it)",
            "due": "2025-03-31",
            "confidence": 0.60
          },
          {
            "text": "Do 100 burpees a day and the morning routine.",
            "due": "2025-03-31",
            "confidence": 0.60
          },
          {
            "text": "Reduce viceral Fat to 5.",
            "due": "2025-03-31",
            "confidence": 0.60
          }
        ]
      }
    ],
    "archived": [
      {
        "objective": "Increase Customer Retention Q1",
        "status": "Achieved",
        "krs": [
          {
            "text": "Improve loyalty program metrics.",
            "due": "2024-02-15",
            "confidence": 0.80
          },
          {
            "text": "Enhance member portal features.",
            "due": "2024-02-28",
            "confidence": 0.75
          },
          {
            "text": "Increase renewal rates by 10%.",
            "due": "2024-03-10",
            "confidence": 0.90
          }
        ]
      },
      {
        "objective": "Improve Product Support Q2",
        "status": "Not Achieved",
        "krs": [
          {
            "text": "Reduce average resolution time by 20%.",
            "due": "2024-04-10",
            "confidence": 0.70
          },
          {
            "text": "Increase support team training hours.",
            "due": "2024-05-05",
            "confidence": 0.60
          },
          {
            "text": "Enhance ticket triaging system.",
            "due": "2024-06-15",
            "confidence": 0.65
          }
        ]
      },
      {
        "objective": "Expand Market Reach Q3",
        "status": "Abandoned",
        "krs": [
          {
            "text": "Test new regional campaigns.",
            "due": "2024-07-05",
            "confidence": 0.50
          },
          {
            "text": "Establish partnerships for local events.",
            "due": "2024-08-10",
            "confidence": 0.55
          },
          {
            "text": "Pilot localized advertising.",
            "due": "2024-09-01",
            "confidence": 0.45
          }
        ]
      }
    ]
  },
  "metrics": [
    { "state": "Fun", "current": 9, "Q-1": 8, "Q-2": 9, "Q-3": 7, "Q-4": 8 },
    { "state": "Friends", "current": 8, "Q-1": 9, "Q-2": 8, "Q-3": 7, "Q-4": 9 },
    { "state": "Health", "current": 10, "Q-1": 9, "Q-2": 8, "Q-3": 9, "Q-4": 8 },
    { "state": "Career", "current": 9, "Q-1": 8, "Q-2": 8, "Q-3": 10, "Q-4": 7 },
    { "state": "Love", "current": 8, "Q-1": 9, "Q-2": 7, "Q-3": 8, "Q-4": 10 },
    { "state": "Spirituality", "current": 7, "Q-1": 8, "Q-2": 9, "Q-3": 8, "Q-4": 9 },
    { "state": "Family", "current": 9, "Q-1": 8, "Q-2": 10, "Q-3": 8, "Q-4": 7 },
    { "state": "Money", "current": 8, "Q-1": 9, "Q-2": 8, "Q-3": 7, "Q-4": 9 }
  ]
}
  </script>
</head>
<body>
  <!-- Page Header -->
  <h1>Gerald O’Connor</h1>
  <div class="container">
    <!-- Values -->
    <div class="section">
      <h2>Values</h2>
      <p>Integrity, empathy and grit.</p>
    </div>
    <!-- Mission -->
    <div class="section">
      <h2>Mission</h2>
      <p>
My mission is to master the art of organizing very large financial institutions to move quickly in the execution and achievement of the right goals (strategy). 
      </p>
            <p>
I create an environment of entrepreneurship, discipline, empathy and achievement.      </p>
    </div>
    <!-- My books -->
    <div class="section">
      <h2>My books</h2>
      <ul>
        <li>
          <a href="https://www.amazon.co.uk/Empower-Let-Go-Unleashing-leadership/dp/1537102605" target="_blank" rel="noopener noreferrer">
            Empower and Let Go
          </a>
        </li>
        <li>
          <a href="https://www.amazon.com/Start-Up-Speed-Enterprise-Achieving/dp/B0DHRCQVMF?dplnkId=7aee636e-3755-4ec5-b40e-60bd2c55cf14&nodl=1" target="_blank" rel="noopener noreferrer">
            Start Up Speed At Enterprise
          </a>
        </li>
      </ul>
    </div>
    <!-- New OKRs, Metrics & Graphs Section -->
    <div class="section" id="okrsMetricsSection">
      <h2>OKRs, Metrics &amp; Graphs</h2>

      <!-- The following sections are generated dynamically using the embedded JSON data -->

      <!-- Parent OKRs -->
      <section>
        <button type="button" class="collapsible">Parent OKRs</button>
        <div class="content" id="parent-okrs-content">
          <div class="okrs-grid" id="parent-okrs-grid">
            <!-- OKR cards will be injected here -->
          </div>
        </div>
      </section>

      <!-- Quarterly OKRs -->
      <section>
        <button type="button" class="collapsible">Quarterly OKRs</button>
        <div class="content" id="quarterly-okrs-content">
          <div class="okrs-grid" id="quarterly-okrs-grid">
            <!-- OKR cards will be injected here -->
          </div>
        </div>
      </section>

      <!-- Archived OKRs -->
      <section>
        <button type="button" class="collapsible">Archived OKRs</button>
        <div class="content" id="archived-okrs-content">
          <div class="okrs-grid" id="archived-okrs-grid">
            <!-- OKR cards will be injected here -->
          </div>
        </div>
      </section>

      <!-- Metrics Section -->
      <section>
        <button type="button" class="collapsible">Metrics</button>
        <div class="content" id="metrics-content">
          <!-- Metrics table will be injected here -->
        </div>
      </section>

      <!-- Graphs Section -->
      <section>
        <button type="button" class="collapsible">Graphs</button>
        <div class="content">
          <div id="graphContainer">
            <canvas id="okrGraph"></canvas>
            <hr style="margin: 2rem 0;" />
            <canvas id="stateGraph"></canvas>
          </div>
        </div>
      </section>
    </div>
    <!-- My Principles Section -->
    <div class="section">
      <h2>My Principles</h2>
      <p>
        I have read or listened to hundreds of books. From each book there might be one line 
        that really resonated with me which has been captured below. I read these principles a few 
        times a week and refine them as I gain more experience and knowledge. If you would like 
        to discuss any of them hit the tweet button below and I'll be tagged.
        <br/>
      </p>
      <!-- Labels (filter buttons) -->
      <div id="labelList" class="label-list"></div>
      <!-- Items will be placed here -->
      <div id="itemList" class="item-list"></div>
    </div>
  </div>

  <script>
    /* -------------------------------
       Existing JS for My Principles (Rules)
    ------------------------------- */
    // Assign a unique pastel color to each label
    const labelColorMap = {
      character: "#FDE2E4",
      "strategy&execution": "#FBF8CC",
      leadership: "#DEF7E5",
      communication: "#DDE4FF",
      negotiation: "#FFE4E1",
      coaching: "#FFF1CC",
      finance: "#FFE5F1",
      health: "#E2F0CB"
    };

    function randomPastel() {
      let r = (Math.random() * 127 + 128) | 0;
      let g = (Math.random() * 127 + 128) | 0;
      let b = (Math.random() * 127 + 128) | 0;
      return `rgb(${r}, ${g}, ${b})`;
    }

    function getLabelColor(label) {
      if (labelColorMap[label]) {
        return labelColorMap[label];
      } else {
        labelColorMap[label] = randomPastel();
        return labelColorMap[label];
      }
    }

    // Updated functions to safely use localStorage
    function loadItemsFromStorage(itemsArray) {
      try {
        const stored = localStorage.getItem("ruleItems");
        if (stored) {
          return JSON.parse(stored);
        } else {
          return itemsArray;
        }
      } catch (err) {
        console.error("Error reading from localStorage:", err);
        return itemsArray;
      }
    }

    function persistItems(itemsToStore) {
      try {
        localStorage.setItem("ruleItems", JSON.stringify(itemsToStore));
      } catch (err) {
        console.error("Error writing to localStorage:", err);
      }
    }

    // Hard-coded rules, with labels as arrays
    const newRules = [
      {
        "priority": 1,
        "title": "My values are grit, empathy, and integrity",
        "labels": ["character"]
      },
      {
        "priority": 1.1,
        "title": "Seek out the toughest challenges because thats what makes you perform better and it transforms you.",
        "labels": ["character, coaching"]
      },
      {
        "priority": 2,
        "title": "Remember you have limited time to achieve your goal, every second brings things closer to being set",
        "labels": ["strategy&execution"]
      },
      {
        "priority": 3,
        "title": "Live every day like it is your last and like you will live forever",
        "labels": ["character"]
      },
      {
        "priority": 4,
        "title": "Never wish time away",
        "labels": ["character"]
      },
      {
        "priority": 5,
        "title": "Do things as fast as is physically and mentally possible, make it a habit",
        "labels": ["character"]
      },
      {
        "priority": 6,
        "title": "Your only limitation is the things you are attached to, and your ability to endure",
        "labels": ["character"]
      },
      {
        "priority": 7,
        "title": "Don’t be attached to anything, and don’t leak your fortune",
        "labels": ["character"]
      },
      {
        "priority": 8,
        "title": "Your mind should always be empty and still and free from attachments and pursuits",
        "labels": ["character"]
      },
      {
        "priority": 9,
        "title": "Never want anything from anyone and your heart will be free, be compassionate to everyone",
        "labels": ["character"]
      },
      {
        "priority": 10,
        "title": "I consistently improve at meeting my commitments and I measure them",
        "labels": ["character"]
      },
      {
        "priority": 11,
        "title": "If you can commit your mind nothing can stop you",
        "labels": ["character"]
      },
      {
        "priority": 11.1,
        "title": "Fatigue makes cowards of us all. Every warrior has his limit, ask for help",
        "labels": ["character"]
      },
      {
        "priority": 11.2,
        "title": "Talent gets you 60% of the way. The rest depends on how much you are willing to fight/endure/persevere/suffer. Leave nothing behind in life.",
        "labels": ["character"]
      },
      {
        "priority": 12,
        "title": "Being a leader means maintaining impeccable standards, and demanding them of others with compassion and empathy",
        "labels": ["leadership"]
      },
      {
        "priority": 13,
        "title": "The job of a leader is not to make the right decisions, but to ensure the right decisions are made [delegation]",
        "labels": ["leadership"]
      },
      {
        "priority": 14,
        "title": "I am an example and an inspiration",
        "labels": ["character","leadership"]
      },
      {
        "priority": 15,
        "title": "I make clear what is acceptable and what is not to do",
        "labels": ["leadership"]
      },
      {
        "priority": 16,
        "title": "Either develop or replace the person if standards are not met",
        "labels": ["leadership"]
      },
      {
        "priority": 17,
        "title": "If there is a cancer, cut it off",
        "labels": ["leadership"]
      },
      {
        "priority": 18,
        "title": "A little neglect may breed great mischief, I never use just this once as an excuse [marginal gains]",
        "labels": ["character","leadership"]
      },
      {
        "priority": 19,
        "title": "Everything you do must be first class",
        "labels": ["character","leadership"]
      },
      {
        "priority": 20,
        "title": "Details matter, only by doing the small things well can you achieve big things [marginal gains]",
        "labels": ["leadership","character"]
      },
      {
        "priority": 21,
        "title": "Check your teams deadlines [commitments] at the start of the week and remind them",
        "labels": ["leadership"]
      },
      {
        "priority": 22,
        "title": "When giving feedback, say: 'I am only saying this because I have high expectations for you’",
        "labels": ["leadership","leadership"]
      },
      {
        "priority": 23,
        "title": "Never say something negative, reframe negatives to positives",
        "labels": ["leadership","communication"]
      },
      {
        "priority": 24,
        "title": "When you are under pressure and being tested, you don’t rise to the occasion, you fall to the level of your knowledge and experience",
        "labels": ["character","leadership"]
      },
      {
        "priority": 25,
        "title": "Always think big and positively. Reframe every challenge situation",
        "labels": ["leadership","communication","strategy&execution"]
      },
      {
        "priority": 26,
        "title": "After a event ask 'how could we do it better'",
        "labels": ["leadership","strategy&execution"]
      },
      {
        "priority": 27,
        "title": "At the start of your day, plan the day, and think through, and commit to the perfect outcome for every event",
        "labels": ["leadership","strategy&execution"]
      },
      {
        "priority": 28,
        "title": "Start from values and principles. Start from first principles. Expand area of agreement, and minimise the area of disagreement",
        "labels": ["negotiation","strategy&execution","leadership"]
      },
      {
        "priority": 29,
        "title": "Never compliment people, find a way for them to move forward",
        "labels": ["leadership"]
      },
      {
        "priority": 30,
        "title": "Think carefully about every word you say, ensure it does not hurt anyone, reframe, and keep doors open",
        "labels": ["communication","leadership"]
      },
      {
        "priority": 31,
        "title": "When someone is angry, acknowledge their anger, validate their feeling and show respect",
        "labels": ["leadership","communication"]
      },
      {
        "priority": 32,
        "title": "Get people to confirm what they are thinking, especially in a conflict situation, expand the agreement and minimize the difference",
        "labels": ["communication","leadership","negotiation"]
      },
      {
        "priority": 33,
        "title": "Don’t build a company, build amazing people",
        "labels": ["leadership"]
      },
      {
        "priority": 34,
        "title": "Think big, start small, empower and focus on the how",
        "labels": ["strategy&execution"]
      },
      {
        "priority": 35,
        "title": "Schedule your highest priorities first",
        "labels": ["strategy&execution"]
      },
      {
        "priority": 36,
        "title": "When defining a goal; opportunity, hypothesis, measure of success, goal",
        "labels": ["strategy&execution"]
      },
      {
        "priority": 37,
        "title": "Define objectives that are significant, concrete, action orientated, and inspirational",
        "labels": ["leadership","strategy&execution"]
      },
      {
        "priority": 38,
        "title": "Right people on the bus wrong people off the bus, right people in the right positions. You do this and you can trust and empower people, you don’t the perfect plan will be useless",
        "labels": ["strategy&execution","leadership"]
      },
      {
        "priority": 39,
        "title": "Ask: How are you strengthening the moat?",
        "labels": ["strategy&execution","leadership"]
      },
      {
        "priority": 40,
        "title": "Schedule no more than 60% of your time, leave room for creativity and unplanned work",
        "labels": ["strategy&execution"]
      },
      {
        "priority": 41,
        "title": "If you are trying to achieve a goal ensure everyone is in the room as you are only as fast as your slowest dependency",
        "labels": ["coaching","strategy&execution"]
      },
      {
        "priority": 42,
        "title": "If you are not at the table, you are on the table",
        "labels": ["strategy&execution"]
      },
      {
        "priority": 43,
        "title": "I focus on outcomes and I achieve them, I am good at building the right team to achieve a goal",
        "labels": ["strategy&execution"]
      },
      {
        "priority": 44,
        "title": "Skate to where the puck is going, not where it has been. Go against the trend",
        "labels": ["strategy&execution"]
      },
      {
        "priority": 45,
        "title": "If something doesn’t contribute, don’t do it",
        "labels": ["strategy&execution"]
      },
      {
        "priority": 46,
        "title": "Once a quarter map out previous week, and delegate everything you can",
        "labels": ["strategy&execution","leadership"]
      },
      {
        "priority": 47,
        "title": "Maintain a buffer for uncertainty and risk",
        "labels": ["strategy&execution"]
      },
      {
        "priority": 48,
        "title": "Read your North Star, OKRs, USM and rules daily to remain laser focused",
        "labels": ["strategy&execution"]
      },
      {
        "priority": 49,
        "title": "Ask for help",
        "labels": ["character","leadership","strategy&execution"]
      },
      {
        "priority": 50,
        "title": "What can I delegate?",
        "labels": ["strategy&execution","leadership"]
      },
      {
        "priority": 51,
        "title": "The number one motivator is optimism, give people something to look forward to",
        "labels": ["strategy&execution","leadership"]
      },
      {
        "priority": 52,
        "title": "The more alignment you create, from the top to the bottom of your organization the more people will notice your contribution and the more influence you will have over time",
        "labels": ["strategy&execution","leadership"]
      },
      {
        "priority": 53,
        "title": "I build feedback loops into everything I do",
        "labels": ["strategy&execution","leadership"]
      },
      {
        "priority": 54,
        "title": "Understand who gets things done in your organisation and find a way to work with them",
        "labels": ["strategy&execution"]
      },
      {
        "priority": 55,
        "title": "When implementing change in an organisation, create a change vision and talk progress to it",
        "labels": ["communication","strategy&execution"]
      },
      {
        "priority": 56,
        "title": "When a management with a reputation for brilliance, tackles a business with a reputation for bad economics It is the reputation of the business that remains intact",
        "labels": ["strategy&execution"]
      },
      {
        "priority": 57,
        "title": "When someone has a goal help them achieve it 100% off the bat, if you see challenges, reframe them to be positive, 'good and better if'",
        "labels": ["character","leadership"]
      },
      {
        "priority": 58,
        "title": "Strategy without tactics is the slowest route to victory, and tactics without strategy is the noise before defeat [Sun Tse]",
        "labels": ["strategy&execution"]
      },
      {
        "priority": 59,
        "title": "Make your audience feel like a hero and they will connect with your message on an emotional level. Ensure that every sentence from the first to the last connects to a goal, and deepens our understanding of being human",
        "labels": ["strategy&execution","communication","leadership"]
      },
      {
        "priority": 60,
        "title": "Who are you speaking to? What do they care about? And why are they attending the session?",
        "labels": ["communication","leadership"]
      },
      {
        "priority": 61,
        "title": "When you speak or write you are a movie projecting into the minds of others, make it a good one",
        "labels": ["communication","leadership"]
      },
      {
        "priority": 62,
        "title": "If you are feeling tense before a presentation reframe it as excitement and embrace the energy",
        "labels": ["communication","leadership"]
      },
      {
        "priority": 63,
        "title": "In a presentation talk to the representative in the audience, regardless of size of the audience, talk directly to them",
        "labels": ["communication","leadership"]
      },
      {
        "priority": 64,
        "title": "Listen to understand, not to reply. Probe with questions",
        "labels": ["leadership","coaching"]
      },
      {
        "priority": 65,
        "title": "When presenting an idea practice presenting it in many different ways so it is just conversation and you've made the connections in your mind",
        "labels": ["communication"]
      },
      {
        "priority": 66,
        "title": "Frame a presentation as a real world person trying to solve a problem the audience had",
        "labels": ["leadership","communication"]
      },
      {
        "priority": 67,
        "title": "Have an opinion. What am I trying to get across? Use sign posts",
        "labels": ["communication","leadership"]
      },
      {
        "priority": 68,
        "title": "Engage the audience",
        "labels": ["communication"]
      },
      {
        "priority": 69,
        "title": "Zoom: if you want to have a presence you have to be seen ask: If you are comfortable and able please turn your camera on, it will make the meeting more engaging",
        "labels": ["communication","leadership"]
      },
      {
        "priority": 70,
        "title": "Write and record every day it brings clarity to your message and how you communicate",
        "labels": ["communication","leadership"]
      },
      {
        "priority": 70,
        "title": "Be careful how you position yourself [label] in peoples mind in your messaging, it will become fixed in their mind and an anchor for you",
        "labels": ["communication","leadership"]
      },
      {
        "priority": 71,
        "title": "Ask questions and be comfortable with silence, if someone is silent give them time, they are thinking. Hold the silence",
        "labels": ["leadership","coaching","communication"]
      },
      {
        "priority": 72,
        "title": "Use consistent vocabulary",
        "labels": ["strategy&execution","communication","leadership"]
      },
      {
        "priority": 73,
        "title": "Be concise, and choose your words carefully",
        "labels": ["communication","leadership"]
      },
      {
        "priority": 74,
        "title": "Wait for the right opportunity to say something, wait until the other party can accept it",
        "labels": ["communication","leadership"]
      },
      {
        "priority": 75,
        "title": "When people are silent, remember they are thinking. Hold the silence",
        "labels": ["communication","leadership"]
      },
      {
        "priority": 76,
        "title": "Greet everyone with a smile and enthusiasm. Make it a habit as it attracts people and opportunities",
        "labels": ["communication"]
      },
      {
        "priority": 77,
        "title": "As a coach, don't have emotion, drive people to achieve their goals",
        "labels": ["coaching","leadership"]
      },
      {
        "priority": 78,
        "title": "Motivate people and max out their potential, every ounce",
        "labels": ["leadership","coaching"]
      },
      {
        "priority": 79,
        "title": "Never give people an out, people can move faster than they think, keep decompressing timelines",
        "labels": ["coaching","leadership"]
      },
      {
        "priority": 80,
        "title": "Start with a question",
        "labels": ["coaching","leadership"]
      },
      {
        "priority": 81,
        "title": "Give tough feedback and make people think after leaving the session",
        "labels": ["coaching","leadership"]
      },
      {
        "priority": 82,
        "title": "Remember as a coach it's their transformation/meeting not yours. If you want it to be directive ask the manager to drive the change",
        "labels": ["coaching"]
      },
      {
        "priority": 83,
        "title": "Only do it, if someone is committed to it, never do it for them. Use AO Coaching Model to map out the problem and solution space, and look for commitment to their next step",
        "labels": ["leadership","coaching"]
      },
      {
        "priority": 84,
        "title": "Be assertive, coaching is only a tool",
        "labels": ["coaching"]
      },
      {
        "priority": 85,
        "title": "Don’t label people as it limits them, praise the effort and improvement",
        "labels": ["leadership","coaching"]
      },
      {
        "priority": 86,
        "title": "I don’t judge people, I meet people where they are",
        "labels": ["leadership","coaching"]
      },
      {
        "priority": 87,
        "title": "If there is a problem, bring it to the team",
        "labels": ["strategy&execution","leadership","coaching"]
      },
      {
        "priority": 88,
        "title": "There is no limit to what the human mind can endure in pursuit of a worthy goal",
        "labels": ["character","leadership"]
      },
      {
        "priority": 89,
        "title": "Never be happy with yourself, pride and complacency are dangerous. Always be Humble",
        "labels": ["character"]
      },
      {
        "priority": 90,
        "title": "Act like you want your future [perfect] self to be in all aspects of your life",
        "labels": ["character"]
      },
      {
        "priority": 91,
        "title": "Enjoy time with others, don’t indulge yourself always be hungry",
        "labels": ["character"]
      },
      {
        "priority": 92,
        "title": "Ask: what does my body need to perform?",
        "labels": ["health"]
      },
      {
        "priority": 93,
        "title": "Use every opportunity to deepen relationships, and make people feel good",
        "labels": ["character"]
      },
      {
        "priority": 94,
        "title": "Drive forward with what you think is right while also being kind, have intent about your time with people, only quality time",
        "labels": ["coaching","character"]
      },
      {
        "priority": 95,
        "title": "Take charge of every situation and don’t be a passenger",
        "labels": ["character"]
      },
      {
        "priority": 96,
        "title": "When you have a social event define a goal and make people feel good",
        "labels": ["character"]
      },
      {
        "priority": 97,
        "title": "Meditate and reflect at the end of the day and bring solutions from the sub conscience",
        "labels": ["character"]
      },
      {
        "priority": 98,
        "title": "When taking feedback just say 'thank you'",
        "labels": ["character"]
      },
      {
        "priority": 99,
        "title": "Always be positive and uplifting,",
        "labels": ["character"]
      },
      {
        "priority": 100,
        "title": "I have a plan for every minute of every day and live intentionally. An idle mind is in the devils hands",
        "labels": ["character"]
      },
      {
        "priority": 101,
        "title": "Don’t give away things that should be precious",
        "labels": ["character"]
      },
      {
        "priority": 102,
        "title": "Don’t give your power away, stay centred",
        "labels": ["character"]
      },
      {
        "priority": 103,
        "title": "Never go where you are not wanted",
        "labels": ["character"]
      },
      {
        "priority": 104,
        "title": "Don’t sit with your back in the chair",
        "labels": ["character"]
      },
      {
        "priority": 105,
        "title": "Only past the edge of endurance is there growth",
        "labels": ["character"]
      },
      {
        "priority": 106,
        "title": "Make people comfortable around you",
        "labels": ["character"]
      },
      {
        "priority": 107,
        "title": "I'm comfortable with being alone",
        "labels": ["character"]
      },
      {
        "priority": 108,
        "title": "When there is a problem, look inside",
        "labels": ["character"]
      },
      {
        "priority": 109,
        "title": "Read your email first every day, and if asked for something, schedule and manage the expectation",
        "labels": ["strategy&execution","communication"]
      },
      {
        "priority": 110,
        "title": "Be Grateful, practice it as a habit, and express it",
        "labels": ["character"]
      },
      {
        "priority": 111,
        "title": "Update your net-worth once a quarter and refine your financial strategy and goals",
        "labels": ["finance"]
      },
      {
        "priority": 112,
        "title": "Invest in the future you want to see",
        "labels": ["finance"]
      },
      {
        "priority": 113,
        "title": "Invest in yourself",
        "labels": ["finance"]
      },
      {
        "priority": 114,
        "title": "Everything you consume becomes part of you, and you have to suffer to lose it [marginal gains in everything]",
        "labels": ["character"]
      },
      {
        "priority": 115,
        "title": "Give everything your all",
        "labels": ["character"]
      },
      {
        "priority": 116,
        "title": "When its cold, you get colder, and when its hot you get hotter",
        "labels": ["character"]
      },
      {
        "priority": 117,
        "title": "Maintain a consistent morning and evening routine these are the foundations for consistent growth",
        "labels": ["character"]
      },
      {
        "priority": 118,
        "title": "Email reminders at the end of the day to remind people why we are meeting, what we aim to achieve, and what they need to prepare",
        "labels": ["leadership","communication","coaching"]
      },
      {
        "priority": 119,
        "title": "Stop and think is what I am going to say necessary and allow the other person to speak more",
        "labels": ["communication","leadership"]
      },
      {
        "priority": 120,
        "title": "Never seek comfort",
        "labels": ["character"]
      },
      {
        "priority": 121,
        "title": "I am a vacuum filled only with good things",
        "labels": ["character"]
      },
      {
        "priority": 122,
        "title": "Max out your gifts",
        "labels": ["character"]
      },
      {
        "priority": 123,
        "title": "What do you need?",
        "labels": ["communication"]
      },
      {
        "priority": 124,
        "title": "Never accept limits or labels",
        "labels": ["character"]
      },
      {
        "priority": 125,
        "title": "Embrace chances to develop richer relationships",
        "labels": ["character"]
      },
      {
        "priority": 126,
        "title": "Ask: does anyone know who I am? Why would they look for me? Do they know where to find me?",
        "labels": ["communication","leadership"]
      },
      {
        "priority": 127,
        "title": "When learning a new concept: [1] Pick the path of least resistance and highest relevance [2] Scope your resources: how much time do I have? [2] Skim read [3] Pick out keywords; anchors [4] search for words you don’t understand and ensure you understand them [5] Build a mental model/structure on what you understand [6] Then when new information comes in; how does it fit? how is it different? Why is it different? [7] second time around build more connections to the anchor points, remove less important anchor points [8] third pass; ask questions to test recall",
        "labels": ['learning']
      },
      {
        "priority": 128,
        "title": "Remember you are exactly where you are supposed to be",
        "labels": ["character"]
      },
      {
        "priority": 129,
        "title": "Think from the other persons perspective",
        "labels": ["negotiation"]
      },
      {
        "priority": 130,
        "title": "You fall to the highest level of preparation",
        "labels": ["negotiation"]
      },
      {
        "priority": 131,
        "title": "At the start of the negotiation map out the landscape",
        "labels": ["negotiation"]
      },
      {
        "priority": 132,
        "title": "A BATNA gives you the courage to walk away",
        "labels": ["negotiation"]
      },
      {
        "priority": 133,
        "title": "Remember negotiation includes Process, Relationship and Substance",
        "labels": ["negotiation"]
      },
      {
        "priority": 134,
        "title": "Use an integrative approach to build common ground and trust",
        "labels": ["negotiation"]
      },
      {
        "priority": 135,
        "title": "Probe with open ended questions allow the counterpart to do the work for you",
        "labels": ["negotiation"]
      },
      {
        "priority": 136,
        "title": "Expand the area of agreement",
        "labels": ["negotiation"]
      },
      {
        "priority": 137,
        "title": "Give people the illusion of control",
        "labels": ["negotiation"]
      },
      {
        "priority": 138,
        "title": "You must understand why the other person is selling",
        "labels": ["negotiation"]
      },
      {
        "priority": 139,
        "title": "The key to identify value is to identify areas the other side values more than you do",
        "labels": ["negotiation"]
      },
      {
        "priority": 140,
        "title": "The other side always has three black swans",
        "labels": ["negotiation"]
      },
      {
        "priority": 141,
        "title": "Once the frame is set offer a low relative anchor",
        "labels": ["negotiation"]
      },
      {
        "priority": 142,
        "title": "'No' starts clarifying the conversation. What exactly are we ruling out?",
        "labels": ["negotiation"]
      },
      {
        "priority": 143,
        "title": "Reject an unacceptable anchor, don’t debate it",
        "labels": []
      },
      {
        "priority": 144,
        "title": "You can make an aggressive anchor, but you must be able to justify it",
        "labels": ["negotiation"]
      },
      {
        "priority": 145,
        "title": "Labelling, get them to confirm the emotions you are seeing. Once you have thrown out a label. Silence, stop and listen. ‘It appears you are angry..’.",
        "labels": ["negotiation"]
      },
      {
        "priority": 146,
        "title": "Neutralise the negative, reinforce the positive. Diffuse the negative. Acknowledge and diffuse it",
        "labels": ["negotiation"]
      },
      {
        "priority": 147,
        "title": "’ Sorry that just doesn’t work me’",
        "labels": ["negotiation"]
      },
      {
        "priority": 148,
        "title": "If there is an ultimatum acknowledge it and change it to an aspiration",
        "labels": ["negotiation"]
      },
      {
        "priority": 149,
        "title": "No option should be discarded until necessary",
        "labels": ["negotiation"]
      },
      {
        "priority": 150,
        "title": "Use a dominating approach when a quick decision is needed or when you have a strong position",
        "labels": ["negotiation"]
      },
      {
        "priority": 151,
        "title": "Differences of opinion about future events don't have to be bridged: they become the core of the contingent contract",
        "labels": ["negotiation"]
      },
      {
        "priority": 152,
        "title": "Steinhouse approach is best when you are negotiating indivisible items because it takes into account, both persons evaluations",
        "labels": ["negotiation"]
      },
      {
        "priority": 153,
        "title": "Nibble more value at the end (That’s unfair)",
        "labels": ["negotiation"]
      },
      {
        "priority": 154,
        "title": "In anything important be the first to anchor",
        "labels": ["negotiation"]
      },
      {
        "priority": 155,
        "title": "Dont accept a bad narrative/anchor, say: I dont like this story. Call me in one hour with a new story. ",
        "labels": ["coaching"]
      },
      { 
        "priority": 156,
        "title": "Have righteous thoughts about your ability to return to your perfect original true self.",
        "labels": ["character"]
      }
      ,
      { 
        "priority": 157,
        "title": "If you are doing something new, ask yourself is there a way AI can help me do this faster? Do I need to be doing this myself or can I outsource it to AI? Then as you find yourself getting more efficient, as you learn new techniques, as you stay up with the state of the art as AI changes then you will be best fit and adapted to work with AI in the future.",
        "labels": ["AI"]
      }      ,
      { 
        "priority": 157,
        "title": "When needs must (chaotic situation, lack of direction), dominate the room.",
        "labels": ["AI"]
      }
    ];

    // Transform each Principle: remove trailing '.' in title and ensure labels are lowercase
    function transformRules(rules) {
      return rules.map((rule) => {
        let titleTrimmed = rule.title.trim().replace(/\.$/, "");
        let transformedLabels = rule.labels.map((lbl) => {
          let trimmed = lbl.trim();
          return trimmed.toLowerCase();
        });
        return {
          priority: rule.priority,
          title: titleTrimmed,
          labels: transformedLabels,
          count: 0,
          tweetCount: 0
        };
      });
    }

    let items = transformRules(newRules);
    items = loadItemsFromStorage(items);
    items.sort((a, b) => a.priority - b.priority);

    // Collect unique labels from all items
    const allLabels = new Set();
    items.forEach((item) => {
      item.labels.forEach((label) => {
        if (label) allLabels.add(label);
      });
    });
    const uniqueLabels = Array.from(allLabels);

    // Keep track of labels toggled on (selected)
    let selectedLabels = new Set();
    const labelListEl = document.getElementById("labelList");
    const itemListEl = document.getElementById("itemList");

    function handleTweetClick(item) {
      item.tweetCount++;
      persistItems(items);
      renderItems(getFilteredItems());
    }

    // Return filtered items based on selected labels
    function getFilteredItems() {
      if (selectedLabels.size === 0) return items;
      return items.filter((item) =>
        item.labels.some((lbl) => selectedLabels.has(lbl))
      );
    }

    function renderItems(itemsToRender) {
      itemListEl.innerHTML = "";
      itemsToRender.forEach((item) => {
        const itemEl = document.createElement("div");
        itemEl.className = "item";

        const priorityEl = document.createElement("div");
        priorityEl.className = "item-priority";
        priorityEl.textContent = `Principle ${item.priority}`;

        const titleEl = document.createElement("div");
        titleEl.className = "item-title";
        titleEl.textContent = item.title;

        // Tweet link (no count displayed)
        const tweetLink = document.createElement("a");
        tweetLink.className = "tweet-icon-link";
        tweetLink.href =
          "https://twitter.com/intent/tweet?text=" +
          encodeURIComponent(
            `@Gerald_oconnor's rule No. ${item.priority}: "${item.title}" For more: https://www.geroconnor.com`
          );
        tweetLink.target = "_blank";
        tweetLink.addEventListener("click", () => handleTweetClick(item));

        const twitterIcon = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        twitterIcon.setAttribute("viewBox", "0 0 24 24");
        twitterIcon.classList.add("tweet-icon");

        const tweetPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        tweetPath.setAttribute(
          "d",
          "M23.954 4.569c-.885.39-1.83.654-2.825.775 1.014-.611 1.793-1.574 2.163-2.723-.951.564-2.005.974-3.127 1.195-.897-.953-2.178-1.548-3.594-1.548-2.717 0-4.92 2.203-4.92 4.917 0 .39.045.765.127 1.124-4.09-.205-7.72-2.164-10.148-5.144-.424.722-.666 1.561-.666 2.475 0 1.71.87 3.213 2.188 4.096-.807-.026-1.566-.248-2.228-.616v.062c0 2.385 1.693 4.374 3.946 4.827-.413.11-.85.17-1.296.17-.317 0-.626-.031-.928-.088.627 1.956 2.445 3.379 4.604 3.417-1.68 1.319-3.809 2.105-6.115 2.105-.398 0-.79-.023-1.175-.069 2.179 1.397 4.768 2.21 7.548 2.21 9.057 0 14.01-7.507 14.01-14.009 0-.21 0-.42-.016-.63.962-.695 1.796-1.562 2.457-2.549z"
        );
        twitterIcon.appendChild(tweetPath);
        tweetLink.appendChild(twitterIcon);

        // Inline labels
        const labelsEl = document.createElement("div");
        labelsEl.classList.add("item-labels");

        item.labels.forEach((lbl) => {
          if (!lbl) return;
          const labelSpan = document.createElement("span");
          labelSpan.className = "inline-label";
          labelSpan.textContent = lbl;
          labelSpan.style.backgroundColor = getLabelColor(lbl);

          labelSpan.addEventListener("click", () => {
            selectedLabels.clear();
            selectedLabels.add(lbl);
            const allTopLabels = labelListEl.getElementsByClassName("label-item");
            Array.from(allTopLabels).forEach((el) => el.classList.remove("active"));
            Array.from(allTopLabels).forEach((el) => {
              if (el.textContent === lbl) {
                el.classList.add("active");
              }
            });
            renderItems(getFilteredItems());
          });
          labelsEl.appendChild(labelSpan);
        });

        itemEl.appendChild(priorityEl);
        itemEl.appendChild(titleEl);
        itemEl.appendChild(tweetLink);
        itemEl.appendChild(labelsEl);
        itemListEl.appendChild(itemEl);
      });
    }

    function renderLabels(labels) {
      labelListEl.innerHTML = "";
      const showAllLabel = document.createElement("div");
      showAllLabel.className = "label-item";
      showAllLabel.textContent = "Show All";
      showAllLabel.style.backgroundColor = "#ECECEC";
      showAllLabel.addEventListener("click", () => {
        selectedLabels.clear();
        Array.from(labelListEl.getElementsByClassName("label-item")).forEach(
          (el) => el.classList.remove("active")
        );
        renderItems(items);
      });
      labelListEl.appendChild(showAllLabel);

      labels.forEach((label) => {
        const labelEl = document.createElement("div");
        labelEl.className = "label-item";
        labelEl.textContent = label;
        labelEl.style.backgroundColor = getLabelColor(label);
        labelEl.addEventListener("click", () => {
          if (selectedLabels.has(label)) {
            selectedLabels.delete(label);
            labelEl.classList.remove("active");
          } else {
            selectedLabels.add(label);
            labelEl.classList.add("active");
          }
          renderItems(getFilteredItems());
        });
        labelListEl.appendChild(labelEl);
      });
    }

    renderLabels(uniqueLabels);
    renderItems(items);
  </script>

  <!-- -------------------------------
       New JS for OKRs, Metrics & Graphs Section
  ------------------------------- -->
  <script>
    // Toggle collapsible sections in the OKRs/Metrics/Graphs block
    Array.from(document.getElementsByClassName("collapsible")).forEach(collapsible => {
      collapsible.addEventListener("click", function () {
        this.classList.toggle("active");
        const content = this.nextElementSibling;
        content.style.display = content.style.display === "block" ? "none" : "block";
      });
    });

    // Render OKR cards from JSON data
    function renderOkrCards(okrsArray, containerId) {
      const container = document.getElementById(containerId);
      container.innerHTML = "";
      okrsArray.forEach(okr => {
        const card = document.createElement("div");
        card.className = "okr-card";

        const objective = document.createElement("h2");
        objective.className = "okr-objective";
        objective.textContent = okr.objective;
        card.appendChild(objective);

        const status = document.createElement("div");
        status.className = "okr-status";
        status.textContent = okr.status;
        card.appendChild(status);

        const krList = document.createElement("ul");
        krList.className = "okr-krs";
        okr.krs.forEach(kr => {
          const li = document.createElement("li");

          const krText = document.createElement("span");
          krText.className = "kr-text";
          krText.textContent = kr.text;
          li.appendChild(krText);

          const krMeta = document.createElement("span");
          krMeta.className = "kr-meta";
          const krDate = document.createElement("span");
          krDate.className = "kr-date";
          krDate.textContent = "Due: " + kr.due;
          krMeta.appendChild(krDate);
          const krConfidence = document.createElement("span");
          krConfidence.className = "kr-confidence";
          krConfidence.textContent = kr.confidence;
          krMeta.appendChild(krConfidence);

          li.appendChild(krMeta);
          krList.appendChild(li);
        });
        card.appendChild(krList);

        container.appendChild(card);
      });
    }

    // Render Metrics table
    function renderMetricsTable(metricsArray, containerId) {
      const container = document.getElementById(containerId);
      container.innerHTML = "";
      const table = document.createElement("table");
      table.className = "metrics-table";

      const caption = document.createElement("caption");
      caption.textContent = "State Variables";
      table.appendChild(caption);

      const thead = document.createElement("thead");
      const headerRow = document.createElement("tr");
      const headers = ["State", "Current Quarter", "Q-1", "Q-2", "Q-3", "Q-4"];
      headers.forEach(headerText => {
        const th = document.createElement("th");
        th.textContent = headerText;
        headerRow.appendChild(th);
      });
      thead.appendChild(headerRow);
      table.appendChild(thead);

      const tbody = document.createElement("tbody");
      metricsArray.forEach(rowData => {
        const tr = document.createElement("tr");
        const tdState = document.createElement("td");
        tdState.textContent = rowData.state;
        tr.appendChild(tdState);

        const tdCurrent = document.createElement("td");
        tdCurrent.textContent = rowData.current;
        tr.appendChild(tdCurrent);

        const tdQ1 = document.createElement("td");
        tdQ1.textContent = rowData["Q-1"];
        tr.appendChild(tdQ1);

        const tdQ2 = document.createElement("td");
        tdQ2.textContent = rowData["Q-2"];
        tr.appendChild(tdQ2);

        const tdQ3 = document.createElement("td");
        tdQ3.textContent = rowData["Q-3"];
        tr.appendChild(tdQ3);

        const tdQ4 = document.createElement("td");
        tdQ4.textContent = rowData["Q-4"];
        tr.appendChild(tdQ4);

        tbody.appendChild(tr);
      });
      table.appendChild(tbody);
      container.appendChild(table);
    }

    // Auto-assign confidence colours based on numeric value
    function assignConfidenceColors() {
      Array.from(document.querySelectorAll(".kr-confidence")).forEach(el => {
        const value = parseFloat(el.textContent.trim());
        el.classList.remove("confidence-red", "confidence-amber", "confidence-green");
        if (value < 0.5) {
          el.classList.add("confidence-red");
        } else if (value < 0.8) {
          el.classList.add("confidence-amber");
        } else {
          el.classList.add("confidence-green");
        }
      });
    }

    // Auto-assign status colours based on text
    function assignStatusColors() {
      Array.from(document.querySelectorAll(".okr-status")).forEach(el => {
        const statusText = el.textContent.trim().toLowerCase();
        el.classList.remove("achieved", "not-achieved", "not-started", "committed", "abandoned");
        if (statusText === "achieved") {
          el.classList.add("achieved");
        } else if (statusText === "not achieved") {
          el.classList.add("not-achieved");
        } else if (statusText === "not started") {
          el.classList.add("not-started");
        } else if (statusText === "committed") {
          el.classList.add("committed");
        } else if (statusText === "abandoned") {
          el.classList.add("abandoned");
        }
      });
    }

    // Read embedded JSON and render OKRs and Metrics
    function renderOkrsMetrics() {
      try {
        const dataElement = document.getElementById("okrsMetricsData");
        const data = JSON.parse(dataElement.textContent);

        // Render OKRs sections
        renderOkrCards(data.okrs.parent, "parent-okrs-grid");
        renderOkrCards(data.okrs.quarterly, "quarterly-okrs-grid");
        renderOkrCards(data.okrs.archived, "archived-okrs-grid");

        // Render Metrics table
        renderMetricsTable(data.metrics, "metrics-content");

        // Assign dynamic colours
        assignConfidenceColors();
        assignStatusColors();
      } catch (err) {
        console.error("Error rendering OKRs and Metrics:", err);
      }
    }

    // Generate the graphs from the already rendered static table (for Metrics)
    function generateOkrGraph() {
      try {
        const archivedGrid = document.getElementById("archived-okrs-grid");
        if (!archivedGrid) {
          console.error("Archived OKRs container not found");
          return;
        }
        const cards = archivedGrid.querySelectorAll(".okr-card");
        const statusData = {
          "achieved": [],
          "not achieved": [],
          "abandoned": []
        };
        cards.forEach(card => {
          const statusElem = card.querySelector(".okr-status");
          if (!statusElem) return;
          const statusText = statusElem.textContent.trim().toLowerCase();
          if (["achieved", "not achieved", "abandoned"].includes(statusText)) {
            const dateElements = card.querySelectorAll(".kr-date");
            let maxDate = null;
            dateElements.forEach(elem => {
              const text = elem.textContent.replace("Due:", "").trim();
              const d = new Date(text);
              if (!isNaN(d.getTime())) {
                if (!maxDate || d > maxDate) {
                  maxDate = d;
                }
              }
            });
            if (maxDate) {
              statusData[statusText].push(maxDate);
            }
          }
        });

        // Group dates by quarter, e.g., "Q1 2024" => count.
        const groups = {};
        const allQuartersSet = new Set();
        for (const status in statusData) {
          groups[status] = {};
          statusData[status].forEach(d => {
            const m = moment(d);
            const quarter = m.quarter();
            const year = m.year();
            const key = "Q" + quarter + " " + year;
            groups[status][key] = (groups[status][key] || 0) + 1;
            allQuartersSet.add(key);
          });
        }

        function quarterToDate(key) {
          const parts = key.split(" ");
          const q = parseInt(parts[0].substring(1));
          const year = parseInt(parts[1]);
          const month = (q - 1) * 3;
          return new Date(year, month, 1);
        }

        const allQuarters = Array.from(allQuartersSet).sort((a, b) => quarterToDate(a) - quarterToDate(b));

        const datasets = [];
        const statusColors = {
          "achieved": "#4caf50",
          "not achieved": "#f44336",
          "abandoned": "#795548"
        };

        for (const status in groups) {
          const dataPoints = allQuarters.map(key => ({
            x: quarterToDate(key),
            y: groups[status][key] || 0
          }));
          datasets.push({
            label: status.charAt(0).toUpperCase() + status.slice(1),
            data: dataPoints,
            fill: false,
            borderColor: statusColors[status],
            tension: 0.1
          });
        }

        const canvasEl = document.getElementById("okrGraph");
        if (!canvasEl) {
          console.error("Canvas element with id 'okrGraph' not found.");
          return;
        }
        const ctx = canvasEl.getContext("2d");
        new Chart(ctx, {
          type: 'line',
          data: { datasets: datasets },
          options: {
            scales: {
              x: {
                type: 'time',
                time: { unit: 'quarter' },
                title: { display: true, text: 'Quarter' }
              },
              y: {
                title: { display: true, text: 'Count' },
                beginAtZero: true,
                ticks: { precision: 0 }
              }
            }
          }
        });
      } catch (error) {
        console.error("Error generating OKRs graph:", error);
      }
    }

    // Generate the State Variables Trend graph from the Metrics table (generated dynamically)
    function generateStateGraph() {
      try {
        const table = document.querySelector(".metrics-table");
        if (!table) {
          console.error("Metrics table not found.");
          return;
        }
        const tbody = table.querySelector("tbody");
        if (!tbody) {
          console.error("Metrics table body not found.");
          return;
        }
        // x-axis labels: from oldest (Q-4) to newest (Current Quarter)
        const xLabels = ["Q-4", "Q-3", "Q-2", "Q-1", "Current Quarter"];
        const datasets = [];
        const colors = [
          "#4caf50", "#f44336", "#2196f3", "#ff9800", "#9c27b0",
          "#795548", "#03a9f4", "#8bc34a"
        ];
        let colorIndex = 0;

        Array.from(tbody.querySelectorAll("tr")).forEach(row => {
          const cells = row.querySelectorAll("td");
          if (cells.length < 6) return;
          const stateName = cells[0].textContent.trim();
          const values = [
            parseFloat(cells[5].textContent.trim()),
            parseFloat(cells[4].textContent.trim()),
            parseFloat(cells[3].textContent.trim()),
            parseFloat(cells[2].textContent.trim()),
            parseFloat(cells[1].textContent.trim())
          ];
          datasets.push({
            label: stateName,
            data: values,
            fill: false,
            borderColor: colors[colorIndex % colors.length],
            tension: 0.1
          });
          colorIndex++;
        });

        const canvasEl = document.getElementById("stateGraph");
        if (!canvasEl) {
          console.error("Canvas element with id 'stateGraph' not found.");
          return;
        }
        const ctx = canvasEl.getContext("2d");
        new Chart(ctx, {
          type: 'line',
          data: {
            labels: xLabels,
            datasets: datasets
          },
          options: {
            scales: {
              y: {
                title: { display: true, text: 'Rating' },
                beginAtZero: true,
                ticks: { precision: 0 }
              },
              x: {
                title: { display: true, text: 'Quarter' }
              }
            }
          }
        });
      } catch (error) {
        console.error("Error generating State Variables graph:", error);
      }
    }

    // On window load, render OKRs/Metrics, generate graphs, and assign colours
    window.addEventListener("load", function() {
      renderOkrsMetrics();
      generateOkrGraph();
      generateStateGraph();
      assignConfidenceColors();
      assignStatusColors();
    });
  </script>
</body>
</html>
