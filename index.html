<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!-- Ensures the page is responsive on mobile devices -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Rules</title>
  <!-- Include Chart.js, Moment.js and the Chart.js Moment adapter -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment"></script>
  <style>
    /* Reset and basic styling */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: sans-serif;
      color: #333;
      line-height: 1.5;
      padding: 1rem;
    }
    /* Headings */
    h1,
    h2 {
      margin-bottom: 0.5rem;
    }
    /* Container */
    .container {
      max-width: 800px;
      margin: 0 auto;
    }
    /* Section spacing */
    .section {
      margin-bottom: 1.5rem;
    }
    .section p {
      margin-top: 0.25rem;
    }
    /* Label List (top labels) */
    .label-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1rem;
      justify-content: center;
    }
    .label-item {
      padding: 0.5rem 1rem;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
      color: #333;
    }
    .label-item.active,
    .label-item:hover {
      opacity: 0.8;
    }
    .label-item.active {
      font-weight: bold;
    }
    /* Item List */
    .item-list {
      width: 100%;
    }
    .item {
      display: flex;
      flex-wrap: wrap; /* Allow wrapping if screen width is small */
      align-items: center;
      gap: 1rem;
      margin-bottom: 0.5rem;
      padding: 0.5rem;
      border-bottom: 1px solid #ccc;
    }
    .item-priority {
      color: #666;
      font-size: 0.9rem;
      font-weight: bold;
    }
    .item-title {
      flex: 1; /* expand to fill space if available */
      font-weight: normal;
    }
    /* Inline labels at the end of each rule */
    .item-labels {
      display: flex;
      flex-wrap: wrap;
      gap: 0.25rem;
    }
    .inline-label {
      border-radius: 5px;
      padding: 0.25rem 0.5rem;
      cursor: pointer;
      transition: background-color 0.3s;
      font-size: 0.8rem;
      color: #333;
    }
    .inline-label:hover {
      opacity: 0.8;
    }
    /* Tweet icon link */
    .tweet-icon-link {
      display: inline-flex;
      align-items: center;
      text-decoration: none;
      gap: 0.25rem; /* space between icon and count */
    }
    .tweet-icon {
      width: 16px;
      height: 16px;
      fill: #1da1f2;
      transition: fill 0.2s;
    }
    .tweet-icon-link:hover .tweet-icon {
      fill: #148cd2;
    }
    /* Responsive adjustments */
    @media (max-width: 600px) {
      .container {
        padding: 0 1rem;
      }
    }
    /* -------------------------------
       New Styles for OKRs, Metrics & Graphs
    ------------------------------- */
    .collapsible {
      background-color: #0073e6;
      color: #fff;
      cursor: pointer;
      padding: 10px 16px;
      width: 100%;
      border: none;
      text-align: left;
      outline: none;
      font-size: 1.5rem;
      border-radius: 4px;
      margin-bottom: 0.5rem;
    }
    .collapsible.active,
    .collapsible:hover {
      background-color: #005bb5;
    }
    .content {
      padding: 0 1rem;
      display: none;
      overflow: hidden;
      border-left: 2px solid #0073e6;
      margin-bottom: 2rem;
    }
    .okrs-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1.5rem;
      margin-top: 1rem;
    }
    .okr-card {
      background: #fff;
      border-radius: 8px;
      padding: 1.5rem;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s;
    }
    .okr-card:hover {
      transform: translateY(-4px);
    }
    .okr-objective {
      font-size: 1.25rem;
      margin-bottom: 0.3rem;
      color: #222;
    }
    .okr-status {
      font-size: 0.9rem;
      font-weight: bold;
      padding: 4px 8px;
      border-radius: 4px;
      display: inline-block;
      margin-bottom: 1rem;
    }
    /* Status classes */
    .achieved {
      background-color: #4caf50;
      color: #fff;
    }
    .not-achieved {
      background-color: #f44336;
      color: #fff;
    }
    .not-started {
      background-color: #9e9e9e;
      color: #fff;
    }
    .in-progress {
      background-color: #2196f3;
      color: #fff;
    }
    .abandoned {
      background-color: #795548;
      color: #fff;
    }
    .okr-krs {
      list-style: none;
      padding-left: 0;
    }
    .okr-krs li {
      background: #f1f1f1;
      margin-bottom: 0.75rem;
      padding: 0.75rem;
      border-radius: 4px;
      font-size: 0.95rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .kr-text {
      flex: 1;
      margin-right: 1rem;
    }
    .kr-meta {
      text-align: right;
    }
    .kr-date {
      display: block;
      font-size: 0.8rem;
      color: #555;
    }
    .kr-confidence {
      display: inline-block;
      padding: 2px 6px;
      font-size: 0.8rem;
      font-weight: bold;
      border-radius: 4px;
      color: #fff;
      margin-top: 0.2rem;
    }
    /* Confidence color classes */
    .confidence-red {
      background-color: #f44336;
    }
    .confidence-amber {
      background-color: #ff9800;
    }
    .confidence-green {
      background-color: #4caf50;
    }
    .metrics-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    .metrics-table th,
    .metrics-table td {
      border: 1px solid #ccc;
      padding: 8px 12px;
      text-align: center;
    }
    .metrics-table th {
      background-color: #0073e6;
      color: #fff;
    }
    .metrics-table caption {
      caption-side: top;
      text-align: left;
      font-size: 1.2rem;
      margin-bottom: 8px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <!-- Page Header -->
  <h1>Gerald Oâ€™Connor</h1>
  <div class="container">
    <!-- Values -->
    <div class="section">
      <h2>Values</h2>
      <p>Integrity, empathy and grit.</p>
    </div>
    <!-- Mission -->
    <div class="section">
      <h2>Mission</h2>
      <p>
        My mission is to make the greatest positive impact on the world by being a servant of
        stakeholders, leaders, clients, staff &amp; society, through driving forward the achievement
        of our goals and company in the realization of our vision/purpose/mission. 
        My niche purpose is mastering the art of organizing very large financial institutions
        to move quickly in completion of the right goals (strategy).
      </p>
    </div>
    <!-- My books -->
    <div class="section">
      <h2>My books</h2>
      <ul>
        <li>
          <a href="https://www.amazon.co.uk/Empower-Let-Go-Unleashing-leadership/dp/1537102605" target="_blank" rel="noopener noreferrer">
            Empower and Let Go
          </a>
        </li>
        <li>
          <a href="https://www.amazon.com/Start-Up-Speed-Enterprise-Achieving/dp/B0DHRCQVMF?dplnkId=7aee636e-3755-4ec5-b40e-60bd2c55cf14&nodl=1" target="_blank" rel="noopener noreferrer">
            Start Up Speed At Enterprise
          </a>
        </li>
      </ul>
    </div>
    <!-- New OKRs, Metrics & Graphs Section inserted after My books -->
    <div class="section">
      <h2>OKRs, Metrics &amp; Graphs</h2>
      <!-- Parent OKRs Collapsible Section -->
      <section>
        <button type="button" class="collapsible">Parent OKRs</button>
        <div class="content">
          <div class="okrs-grid">
            <!-- Parent OKR Card 1: Achieved -->
            <div class="okr-card" data-priority="2">
              <h2 class="okr-objective">Grow and Diversify Revenue</h2>
              <div class="okr-status achieved">Achieved</div>
              <ul class="okr-krs">
                <li>
                  <span class="kr-text">Increase new customer acquisitions by 20% in Q1.</span>
                  <span class="kr-meta">
                    <span class="kr-date">Due: 2025-06-15</span>
                    <span class="kr-confidence">0.35</span>
                  </span>
                </li>
                <li>
                  <span class="kr-text">Expand into 2 new geographic regions by Q2.</span>
                  <span class="kr-meta">
                    <span class="kr-date">Due: 2025-08-20</span>
                    <span class="kr-confidence">0.65</span>
                  </span>
                </li>
                <li>
                  <span class="kr-text">Boost overall sales by 15% by year-end.</span>
                  <span class="kr-meta">
                    <span class="kr-date">Due: 2025-12-31</span>
                    <span class="kr-confidence">0.85</span>
                  </span>
                </li>
              </ul>
            </div>
            <!-- Parent OKR Card 2: Not Achieved -->
            <div class="okr-card" data-priority="1">
              <h2 class="okr-objective">Enhance Employee Engagement</h2>
              <div class="okr-status not achieved">Not Achieved</div>
              <ul class="okr-krs">
                <li>
                  <span class="kr-text">Achieve at least 95% employee satisfaction in the annual survey.</span>
                  <span class="kr-meta">
                    <span class="kr-date">Due: 2025-05-20</span>
                    <span class="kr-confidence">0.90</span>
                  </span>
                </li>
                <li>
                  <span class="kr-text">Reduce employee turnover by 15% by Q3.</span>
                  <span class="kr-meta">
                    <span class="kr-date">Due: 2025-09-10</span>
                    <span class="kr-confidence">0.60</span>
                  </span>
                </li>
                <li>
                  <span class="kr-text">Increase participation in professional development programs by 30%.</span>
                  <span class="kr-meta">
                    <span class="kr-date">Due: 2025-11-15</span>
                    <span class="kr-confidence">0.40</span>
                  </span>
                </li>
              </ul>
            </div>
            <!-- Parent OKR Card 3: In Progress -->
            <div class="okr-card" data-priority="3">
              <h2 class="okr-objective">Improve Operational Efficiency</h2>
              <div class="okr-status in progress">In Progress</div>
              <ul class="okr-krs">
                <li>
                  <span class="kr-text">Reduce process bottlenecks to cut average project time by 20%.</span>
                  <span class="kr-meta">
                    <span class="kr-date">Due: 2025-07-01</span>
                    <span class="kr-confidence">0.80</span>
                  </span>
                </li>
                <li>
                  <span class="kr-text">Automate 50% of routine tasks by Q4.</span>
                  <span class="kr-meta">
                    <span class="kr-date">Due: 2025-09-30</span>
                    <span class="kr-confidence">0.70</span>
                  </span>
                </li>
                <li>
                  <span class="kr-text">Increase overall customer satisfaction above 90% by next quarter.</span>
                  <span class="kr-meta">
                    <span class="kr-date">Due: 2025-10-15</span>
                    <span class="kr-confidence">0.45</span>
                  </span>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </section>
      <!-- Quarterly OKRs Collapsible Section -->
      <section>
        <button type="button" class="collapsible">Quarterly OKRs</button>
        <div class="content">
          <div class="okrs-grid">
            <!-- Quarterly OKR Card 1: Achieved -->
            <div class="okr-card" data-priority="2">
              <h2 class="okr-objective">Increase Market Share</h2>
              <div class="okr-status achieved">Achieved</div>
              <ul class="okr-krs">
                <li>
                  <span class="kr-text">Acquire 500 new users this quarter.</span>
                  <span class="kr-meta">
                    <span class="kr-date">Due: 2025-03-10</span>
                    <span class="kr-confidence">0.80</span>
                  </span>
                </li>
                <li>
                  <span class="kr-text">Improve website conversion by 10%.</span>
                  <span class="kr-meta">
                    <span class="kr-date">Due: 2025-03-15</span>
                    <span class="kr-confidence">0.65</span>
                  </span>
                </li>
                <li>
                  <span class="kr-text">Gain 3 new key strategic partners.</span>
                  <span class="kr-meta">
                    <span class="kr-date">Due: 2025-03-20</span>
                    <span class="kr-confidence">0.40</span>
                  </span>
                </li>
              </ul>
            </div>
            <!-- Quarterly OKR Card 2: Not Started -->
            <div class="okr-card" data-priority="1">
              <h2 class="okr-objective">Enhance Product Quality</h2>
              <div class="okr-status not started">Not Started</div>
              <ul class="okr-krs">
                <li>
                  <span class="kr-text">Reduce product defects by 25%.</span>
                  <span class="kr-meta">
                    <span class="kr-date">Due: 2025-03-05</span>
                    <span class="kr-confidence">0.85</span>
                  </span>
                </li>
                <li>
                  <span class="kr-text">Update 3 major features based on user feedback.</span>
                  <span class="kr-meta">
                    <span class="kr-date">Due: 2025-03-08</span>
                    <span class="kr-confidence">0.70</span>
                  </span>
                </li>
                <li>
                  <span class="kr-text">Launch beta program for upcoming product version.</span>
                  <span class="kr-meta">
                    <span class="kr-date">Due: 2025-03-12</span>
                    <span class="kr-confidence">0.50</span>
                  </span>
                </li>
              </ul>
            </div>
            <!-- Quarterly OKR Card 3: In Progress -->
            <div class="okr-card" data-priority="3">
              <h2 class="okr-objective">Boost Operational Agility</h2>
              <div class="okr-status in progress">In Progress</div>
              <ul class="okr-krs">
                <li>
                  <span class="kr-text">Implement agile methodologies in 80% of teams.</span>
                  <span class="kr-meta">
                    <span class="kr-date">Due: 2025-03-18</span>
                    <span class="kr-confidence">0.90</span>
                  </span>
                </li>
                <li>
                  <span class="kr-text">Increase cross-functional collaboration by 20%.</span>
                  <span class="kr-meta">
                    <span class="kr-date">Due: 2025-03-22</span>
                    <span class="kr-confidence">0.65</span>
                  </span>
                </li>
                <li>
                  <span class="kr-text">Reduce project turnaround time by 15%.</span>
                  <span class="kr-meta">
                    <span class="kr-date">Due: 2025-03-25</span>
                    <span class="kr-confidence">0.40</span>
                  </span>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </section>
      <!-- Archived OKRs Collapsible Section -->
      <section>
        <button type="button" class="collapsible">Archived OKRs</button>
        <div class="content">
          <div class="okrs-grid" id="archived-okrs">
            <!-- Archived OKR Card 1: Achieved (Q1) -->
            <div class="okr-card" data-priority="2">
              <h2 class="okr-objective">Increase Customer Retention Q1</h2>
              <div class="okr-status achieved">Achieved</div>
              <ul class="okr-krs">
                <li>
                  <span class="kr-text">Improve loyalty program metrics.</span>
                  <span class="kr-meta">
                    <span class="kr-date">Due: 2024-02-15</span>
                    <span class="kr-confidence">0.80</span>
                  </span>
                </li>
                <li>
                  <span class="kr-text">Enhance member portal features.</span>
                  <span class="kr-meta">
                    <span class="kr-date">Due: 2024-02-28</span>
                    <span class="kr-confidence">0.75</span>
                  </span>
                </li>
                <li>
                  <span class="kr-text">Increase renewal rates by 10%.</span>
                  <span class="kr-meta">
                    <span class="kr-date">Due: 2024-03-10</span>
                    <span class="kr-confidence">0.90</span>
                  </span>
                </li>
              </ul>
            </div>
            <!-- Archived OKR Card 2: Not Achieved (Q2) -->
            <div class="okr-card" data-priority="1">
              <h2 class="okr-objective">Improve Product Support Q2</h2>
              <div class="okr-status not achieved">Not Achieved</div>
              <ul class="okr-krs">
                <li>
                  <span class="kr-text">Reduce average resolution time by 20%.</span>
                  <span class="kr-meta">
                    <span class="kr-date">Due: 2024-04-10</span>
                    <span class="kr-confidence">0.70</span>
                  </span>
                </li>
                <li>
                  <span class="kr-text">Increase support team training hours.</span>
                  <span class="kr-meta">
                    <span class="kr-date">Due: 2024-05-05</span>
                    <span class="kr-confidence">0.60</span>
                  </span>
                </li>
                <li>
                  <span class="kr-text">Enhance ticket triaging system.</span>
                  <span class="kr-meta">
                    <span class="kr-date">Due: 2024-06-15</span>
                    <span class="kr-confidence">0.65</span>
                  </span>
                </li>
              </ul>
            </div>
            <!-- Archived OKR Card 3: Abandoned (Q3) -->
            <div class="okr-card" data-priority="3">
              <h2 class="okr-objective">Expand Market Reach Q3</h2>
              <div class="okr-status abandoned">Abandoned</div>
              <ul class="okr-krs">
                <li>
                  <span class="kr-text">Test new regional campaigns.</span>
                  <span class="kr-meta">
                    <span class="kr-date">Due: 2024-07-05</span>
                    <span class="kr-confidence">0.50</span>
                  </span>
                </li>
                <li>
                  <span class="kr-text">Establish partnerships for local events.</span>
                  <span class="kr-meta">
                    <span class="kr-date">Due: 2024-08-10</span>
                    <span class="kr-confidence">0.55</span>
                  </span>
                </li>
                <li>
                  <span class="kr-text">Pilot localized advertising.</span>
                  <span class="kr-meta">
                    <span class="kr-date">Due: 2024-09-01</span>
                    <span class="kr-confidence">0.45</span>
                  </span>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </section>
      <!-- Metrics Collapsible Section -->
      <section>
        <button type="button" class="collapsible">Metrics</button>
        <div class="content">
          <table class="metrics-table">
            <caption>State Variables</caption>
            <thead>
              <tr>
                <th>State</th>
                <th>Current Quarter</th>
                <th>Q-1</th>
                <th>Q-2</th>
                <th>Q-3</th>
                <th>Q-4</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Fun</td>
                <td>9</td>
                <td>8</td>
                <td>9</td>
                <td>7</td>
                <td>8</td>
              </tr>
              <tr>
                <td>Friends</td>
                <td>8</td>
                <td>9</td>
                <td>8</td>
                <td>7</td>
                <td>9</td>
              </tr>
              <tr>
                <td>Health</td>
                <td>10</td>
                <td>9</td>
                <td>8</td>
                <td>9</td>
                <td>8</td>
              </tr>
              <tr>
                <td>Career</td>
                <td>9</td>
                <td>8</td>
                <td>8</td>
                <td>10</td>
                <td>7</td>
              </tr>
              <tr>
                <td>Love</td>
                <td>8</td>
                <td>9</td>
                <td>7</td>
                <td>8</td>
                <td>10</td>
              </tr>
              <tr>
                <td>Spirituality</td>
                <td>7</td>
                <td>8</td>
                <td>9</td>
                <td>8</td>
                <td>9</td>
              </tr>
              <tr>
                <td>Family</td>
                <td>9</td>
                <td>8</td>
                <td>10</td>
                <td>8</td>
                <td>7</td>
              </tr>
              <tr>
                <td>Money</td>
                <td>8</td>
                <td>9</td>
                <td>8</td>
                <td>7</td>
                <td>9</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
      <!-- Graphs Collapsible Section -->
      <section>
        <button type="button" class="collapsible">Graphs</button>
        <div class="content">
          <div id="graphContainer">
            <canvas id="okrGraph"></canvas>
            <hr style="margin: 2rem 0;" />
            <canvas id="stateGraph"></canvas>
          </div>
        </div>
      </section>
    </div>
    <!-- My Principles Section -->
    <div class="section">
      <h2>My Principles</h2>
      <p>
        I have read or listened to hundreds of books. From each book there might be one line 
        that really resonated with me which has been captured below. I read these principles a few 
        times a week and refine them as I gain more experience and knowledge. If you would like 
        to discuss any of them hit the tweet button below and I'll be tagged.
        <br/>
      </p>
      <!-- Labels (filter buttons) -->
      <div id="labelList" class="label-list"></div>
      <!-- Items will be placed here -->
      <div id="itemList" class="item-list"></div>
    </div>
  </div>

  <script>
    /* -------------------------------
       Existing JS for My Principles
    ------------------------------- */
    // Assign a unique pastel color to each label
    const labelColorMap = {
      character: "#FDE2E4",
      "strategy&execution": "#FBF8CC",
      leadership: "#DEF7E5",
      communication: "#DDE4FF",
      negotiation: "#FFE4E1",
      coaching: "#FFF1CC",
      finance: "#FFE5F1",
      health: "#E2F0CB"
    };

    function randomPastel() {
      let r = (Math.random() * 127 + 128) | 0;
      let g = (Math.random() * 127 + 128) | 0;
      let b = (Math.random() * 127 + 128) | 0;
      return `rgb(${r}, ${g}, ${b})`;
    }

    function getLabelColor(label) {
      if (labelColorMap[label]) {
        return labelColorMap[label];
      } else {
        labelColorMap[label] = randomPastel();
        return labelColorMap[label];
      }
    }

    // Updated functions to safely use localStorage
    function loadItemsFromStorage(itemsArray) {
      try {
        const stored = localStorage.getItem("ruleItems");
        if (stored) {
          return JSON.parse(stored);
        } else {
          return itemsArray;
        }
      } catch (err) {
        console.error("Error reading from localStorage:", err);
        return itemsArray;
      }
    }

    function persistItems(itemsToStore) {
      try {
        localStorage.setItem("ruleItems", JSON.stringify(itemsToStore));
      } catch (err) {
        console.error("Error writing to localStorage:", err);
      }
    }

    // Hard-coded rules, with labels as arrays
    const newRules = [
      {
          "priority": 1,
          "title": "My values are grit, empathy, and integrity",
          "labels": ["character"]
      },
      {
          "priority": 2,
          "title": "Remember you have limited time to achieve your goal, every second brings things closer to being set",
          "labels": ["strategy&execution"]
      }
      // ... additional rules as needed...
    ];

    // Transform each Principle: remove trailing '.' in title and ensure labels are lowercase
    function transformRules(rules) {
      return rules.map((rule) => {
        let titleTrimmed = rule.title.trim().replace(/\.$/, "");
        let transformedLabels = rule.labels.map((lbl) => {
          let trimmed = lbl.trim();
          return trimmed.toLowerCase();
        });
        return {
          priority: rule.priority,
          title: titleTrimmed,
          labels: transformedLabels,
          count: 0,
          tweetCount: 0
        };
      });
    }

    let items = transformRules(newRules);
    items = loadItemsFromStorage(items);
    items.sort((a, b) => a.priority - b.priority);

    // Collect unique labels from all items
    const allLabels = new Set();
    items.forEach((item) => {
      item.labels.forEach((label) => {
        if (label) allLabels.add(label);
      });
    });
    const uniqueLabels = Array.from(allLabels);

    // Keep track of labels toggled on (selected)
    let selectedLabels = new Set();
    const labelListEl = document.getElementById("labelList");
    const itemListEl = document.getElementById("itemList");

    function handleTweetClick(item) {
      item.tweetCount++;
      persistItems(items);
      renderItems(getFilteredItems());
    }

    // Return filtered items based on selected labels
    function getFilteredItems() {
      if (selectedLabels.size === 0) return items;
      return items.filter((item) =>
        item.labels.some((lbl) => selectedLabels.has(lbl))
      );
    }

    function renderItems(itemsToRender) {
      itemListEl.innerHTML = "";
      itemsToRender.forEach((item) => {
        const itemEl = document.createElement("div");
        itemEl.className = "item";

        const priorityEl = document.createElement("div");
        priorityEl.className = "item-priority";
        priorityEl.textContent = `Principle ${item.priority}`;

        const titleEl = document.createElement("div");
        titleEl.className = "item-title";
        titleEl.textContent = item.title;

        // Tweet link (no count displayed)
        const tweetLink = document.createElement("a");
        tweetLink.className = "tweet-icon-link";
        tweetLink.href =
          "https://twitter.com/intent/tweet?text=" +
          encodeURIComponent(
            `@Gerald_oconnor's rule No. ${item.priority}: "${item.title}" For more: https://www.geroconnor.com`
          );
        tweetLink.target = "_blank";
        tweetLink.addEventListener("click", () => handleTweetClick(item));

        const twitterIcon = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        twitterIcon.setAttribute("viewBox", "0 0 24 24");
        twitterIcon.classList.add("tweet-icon");

        const tweetPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        tweetPath.setAttribute(
          "d",
          "M23.954 4.569c-.885.39-1.83.654-2.825.775 1.014-.611 1.793-1.574 2.163-2.723-.951.564-2.005.974-3.127 1.195-.897-.953-2.178-1.548-3.594-1.548-2.717 0-4.92 2.203-4.92 4.917 0 .39.045.765.127 1.124-4.09-.205-7.72-2.164-10.148-5.144-.424.722-.666 1.561-.666 2.475 0 1.71.87 3.213 2.188 4.096-.807-.026-1.566-.248-2.228-.616v.062c0 2.385 1.693 4.374 3.946 4.827-.413.11-.85.17-1.296.17-.317 0-.626-.031-.928-.088.627 1.956 2.445 3.379 4.604 3.417-1.68 1.319-3.809 2.105-6.115 2.105-.398 0-.79-.023-1.175-.069 2.179 1.397 4.768 2.21 7.548 2.21 9.057 0 14.01-7.507 14.01-14.009 0-.21 0-.42-.016-.63.962-.695 1.796-1.562 2.457-2.549z"
        );
        twitterIcon.appendChild(tweetPath);
        tweetLink.appendChild(twitterIcon);

        // Inline labels
        const labelsEl = document.createElement("div");
        labelsEl.classList.add("item-labels");

        item.labels.forEach((lbl) => {
          if (!lbl) return;
          const labelSpan = document.createElement("span");
          labelSpan.className = "inline-label";
          labelSpan.textContent = lbl;
          labelSpan.style.backgroundColor = getLabelColor(lbl);

          labelSpan.addEventListener("click", () => {
            selectedLabels.clear();
            selectedLabels.add(lbl);
            const allTopLabels = labelListEl.getElementsByClassName("label-item");
            Array.from(allTopLabels).forEach((el) => el.classList.remove("active"));
            Array.from(allTopLabels).forEach((el) => {
              if (el.textContent === lbl) {
                el.classList.add("active");
              }
            });
            renderItems(getFilteredItems());
          });
          labelsEl.appendChild(labelSpan);
        });

        itemEl.appendChild(priorityEl);
        itemEl.appendChild(titleEl);
        itemEl.appendChild(tweetLink);
        itemEl.appendChild(labelsEl);
        itemListEl.appendChild(itemEl);
      });
    }

    function renderLabels(labels) {
      labelListEl.innerHTML = "";
      const showAllLabel = document.createElement("div");
      showAllLabel.className = "label-item";
      showAllLabel.textContent = "Show All";
      showAllLabel.style.backgroundColor = "#ECECEC";
      showAllLabel.addEventListener("click", () => {
        selectedLabels.clear();
        Array.from(labelListEl.getElementsByClassName("label-item")).forEach(
          (el) => el.classList.remove("active")
        );
        renderItems(items);
      });
      labelListEl.appendChild(showAllLabel);

      labels.forEach((label) => {
        const labelEl = document.createElement("div");
        labelEl.className = "label-item";
        labelEl.textContent = label;
        labelEl.style.backgroundColor = getLabelColor(label);
        labelEl.addEventListener("click", () => {
          if (selectedLabels.has(label)) {
            selectedLabels.delete(label);
            labelEl.classList.remove("active");
          } else {
            selectedLabels.add(label);
            labelEl.classList.add("active");
          }
          renderItems(getFilteredItems());
        });
        labelListEl.appendChild(labelEl);
      });
    }

    renderLabels(uniqueLabels);
    renderItems(items);
  </script>

  <!-- -------------------------------
       New JS for OKRs, Metrics & Graphs Section
  ------------------------------- -->
  <script>
    // Toggle collapsible sections for the new block
    Array.from(document.getElementsByClassName("collapsible")).forEach(collapsible => {
      collapsible.addEventListener("click", function () {
        this.classList.toggle("active");
        const content = this.nextElementSibling;
        content.style.display = content.style.display === "block" ? "none" : "block";
      });
    });

    // Function to generate the OKRs Trend graph (using Archived OKRs)
    function generateOkrGraph() {
      try {
        const archivedGrid = document.getElementById("archived-okrs");
        if (!archivedGrid) {
          console.error("Archived OKRs container not found");
          return;
        }
        const cards = archivedGrid.querySelectorAll(".okr-card");
        const statusData = {
          "achieved": [],
          "not achieved": [],
          "abandoned": []
        };
        cards.forEach(card => {
          const statusElem = card.querySelector(".okr-status");
          if (!statusElem) return;
          const statusText = statusElem.textContent.trim().toLowerCase();
          if (["achieved", "not achieved", "abandoned"].includes(statusText)) {
            const dateElements = card.querySelectorAll(".kr-date");
            let maxDate = null;
            dateElements.forEach(elem => {
              const text = elem.textContent.replace("Due:", "").trim();
              const d = new Date(text);
              if (!isNaN(d.getTime())) {
                if (!maxDate || d > maxDate) {
                  maxDate = d;
                }
              }
            });
            if (maxDate) {
              statusData[statusText].push(maxDate);
            }
          }
        });

        // Group dates by quarter, e.g., "Q1 2024" => count.
        const groups = {};
        const allQuartersSet = new Set();
        for (const status in statusData) {
          groups[status] = {};
          statusData[status].forEach(d => {
            const m = moment(d);
            const quarter = m.quarter();
            const year = m.year();
            const key = "Q" + quarter + " " + year;
            groups[status][key] = (groups[status][key] || 0) + 1;
            allQuartersSet.add(key);
          });
        }

        function quarterToDate(key) {
          const parts = key.split(" ");
          const q = parseInt(parts[0].substring(1));
          const year = parseInt(parts[1]);
          const month = (q - 1) * 3;
          return new Date(year, month, 1);
        }

        const allQuarters = Array.from(allQuartersSet).sort((a, b) => quarterToDate(a) - quarterToDate(b));

        const datasets = [];
        const statusColors = {
          "achieved": "#4caf50",
          "not achieved": "#f44336",
          "abandoned": "#795548"
        };

        for (const status in groups) {
          const dataPoints = allQuarters.map(key => ({
            x: quarterToDate(key),
            y: groups[status][key] || 0
          }));
          datasets.push({
            label: status.charAt(0).toUpperCase() + status.slice(1),
            data: dataPoints,
            fill: false,
            borderColor: statusColors[status],
            tension: 0.1
          });
        }

        const canvasEl = document.getElementById("okrGraph");
        if (!canvasEl) {
          console.error("Canvas element with id 'okrGraph' not found.");
          return;
        }
        const ctx = canvasEl.getContext("2d");
        new Chart(ctx, {
          type: 'line',
          data: { datasets: datasets },
          options: {
            scales: {
              x: {
                type: 'time',
                time: { unit: 'quarter' },
                title: { display: true, text: 'Quarter' }
              },
              y: {
                title: { display: true, text: 'Count' },
                beginAtZero: true,
                ticks: { precision: 0 }
              }
            }
          }
        });
      } catch (error) {
        console.error("Error generating OKRs graph:", error);
      }
    }

    // Generate the State Variables Trend graph from the Metrics table
    function generateStateGraph() {
      try {
        const table = document.querySelector(".metrics-table");
        if (!table) {
          console.error("Metrics table not found.");
          return;
        }
        const tbody = table.querySelector("tbody");
        if (!tbody) {
          console.error("Metrics table body not found.");
          return;
        }
        // x-axis labels: from oldest (Q-4) to newest (Current Quarter)
        const xLabels = ["Q-4", "Q-3", "Q-2", "Q-1", "Current Quarter"];
        const datasets = [];
        const colors = [
          "#4caf50", "#f44336", "#2196f3", "#ff9800", "#9c27b0",
          "#795548", "#03a9f4", "#8bc34a"
        ];
        let colorIndex = 0;

        Array.from(tbody.querySelectorAll("tr")).forEach(row => {
          const cells = row.querySelectorAll("td");
          if (cells.length < 6) return;
          const stateName = cells[0].textContent.trim();
          const values = [
            parseFloat(cells[5].textContent.trim()),
            parseFloat(cells[4].textContent.trim()),
            parseFloat(cells[3].textContent.trim()),
            parseFloat(cells[2].textContent.trim()),
            parseFloat(cells[1].textContent.trim())
          ];
          datasets.push({
            label: stateName,
            data: values,
            fill: false,
            borderColor: colors[colorIndex % colors.length],
            tension: 0.1
          });
          colorIndex++;
        });

        const canvasEl = document.getElementById("stateGraph");
        if (!canvasEl) {
          console.error("Canvas element with id 'stateGraph' not found.");
          return;
        }
        const ctx = canvasEl.getContext("2d");
        new Chart(ctx, {
          type: 'line',
          data: {
            labels: xLabels,
            datasets: datasets
          },
          options: {
            scales: {
              y: {
                title: { display: true, text: 'Rating' },
                beginAtZero: true,
                ticks: { precision: 0 }
              },
              x: {
                title: { display: true, text: 'Quarter' }
              }
            }
          }
        });
      } catch (error) {
        console.error("Error generating State Variables graph:", error);
      }
    }

    // Auto-assign confidence colours based on numeric value
    function assignConfidenceColors() {
      Array.from(document.querySelectorAll(".kr-confidence")).forEach(el => {
        const value = parseFloat(el.textContent.trim());
        el.classList.remove("confidence-red", "confidence-amber", "confidence-green");
        if (value < 0.5) {
          el.classList.add("confidence-red");
        } else if (value < 0.8) {
          el.classList.add("confidence-amber");
        } else {
          el.classList.add("confidence-green");
        }
      });
    }

    // Auto-assign status colours based on text
    function assignStatusColors() {
      Array.from(document.querySelectorAll(".okr-status")).forEach(el => {
        const statusText = el.textContent.trim().toLowerCase();
        el.classList.remove("achieved", "not-achieved", "not-started", "in-progress", "abandoned");
        if (statusText === "achieved") {
          el.classList.add("achieved");
        } else if (statusText === "not achieved") {
          el.classList.add("not-achieved");
        } else if (statusText === "not started") {
          el.classList.add("not-started");
        } else if (statusText === "in progress") {
          el.classList.add("in-progress");
        } else if (statusText === "abandoned") {
          el.classList.add("abandoned");
        }
      });
    }

    // Generate the graphs and then assign colors after page load
    window.addEventListener("load", function() {
      generateOkrGraph();
      generateStateGraph();
      // Re-assign classes for status and confidence levels for newly rendered elements
      assignConfidenceColors();
      assignStatusColors();
    });
  </script>
</body>
</html>
